<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Translator - Voice Roots</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans&display=swap" rel="stylesheet"/>
<style>
:root{
  --purple:#6c63ff;
  --purple-dark:#5548c8;
  --bg:#f9f8ff;
  --card:#fff;
  --muted:#666;
  --radius:12px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Open Sans",system-ui,Arial;
  background:var(--bg);
  padding:26px;
}
.wrap{max-width:920px;margin:30px auto;background:var(--card);padding:30px;border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,0.08)}
h1{font-family:'Montserrat',sans-serif;margin:0 0 14px 0;font-size:28px;color:#222}
label{display:block;margin-top:12px;font-weight:700;color:#333}
select, textarea{width:100%;padding:10px;margin-top:8px;border-radius:10px;border:1px solid #ddd;resize:vertical}
.controls{display:flex;gap:10px;margin-top:12px}
button{background:var(--purple);color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700}
button:hover{background:var(--purple-dark)}
.status{margin-top:8px;color:#444}
textarea[readonly]{background:#f5f5f7}
.chip{display:inline-block;padding:3px 8px;border:1px solid #ddd;border-radius:12px;margin-right:6px;margin-top:4px;cursor:pointer;}
</style>
</head>
<body>
<div class="wrap">
  <h1>üåê Translator</h1>

  <label>From Language</label>
  <select id="fromLang">
    <option value="en">English</option>
    <option value="hi">Hindi</option>
    <option value="bn">Bengali</option>
    <option value="ta">Tamil</option>
    <option value="te">Telugu</option>
    <option value="ml">Malayalam</option>
    <option value="kn">Kannada</option>
    <option value="gu">Gujarati</option>
    <option value="pa">Punjabi</option>
    <option value="or">Odia</option>
    <option value="as">Assamese</option>
    <option value="ur">Urdu</option>
  </select>

  <label>To Language</label>
  <select id="toLang">
    <option value="hi">Hindi</option>
    <option value="en">English</option>
    <option value="bn">Bengali</option>
    <option value="ta">Tamil</option>
    <option value="te">Telugu</option>
    <option value="ml">Malayalam</option>
    <option value="kn">Kannada</option>
    <option value="gu">Gujarati</option>
    <option value="pa">Punjabi</option>
    <option value="or">Odia</option>
    <option value="as">Assamese</option>
    <option value="ur">Urdu</option>
  </select>

  <label>Translation Style</label>
  <select id="style">
    <option value="natural">Natural</option>
    <option value="translit">Transliteration</option>
  </select>

  <label>Enter text to translate</label>
  <textarea id="inputText" rows="4" placeholder="Type text here..."></textarea>

  <div class="controls">
    <button id="translateButton">üîÑ Translate</button>
    <button id="voiceButton">üé§ Voice</button>
  </div>

  <div class="status" id="status"></div>

  <label style="margin-top:14px">Translation Result</label>
  <textarea id="outputText" rows="4" readonly></textarea>
  <div id="alts"></div>

  <div style="margin-top:14px">
    <a href="index.html" style="text-decoration:none;">
      <button style="background:#999">‚¨Ö Back</button>
    </a>
  </div>
</div>

<script>
/* ====== CURATED OVERRIDES ====== */
const OVERRIDES = { 
  hi:{
    "hello":["‡§®‡§Æ‡§∏‡•ç‡§§‡•á","‡§π‡•à‡§≤‡•ã"],"hi":["‡§®‡§Æ‡§∏‡•ç‡§§‡•á","‡§π‡§æ‡§Ø"],
    "thanks":["‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶"],"thank you":["‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶"],
    "sorry":["‡§Æ‡§æ‡§´‡§º ‡§ï‡•Ä‡§ú‡§ø‡§è"],"please":["‡§ï‡•É‡§™‡§Ø‡§æ"],
    "good morning":["‡§∏‡•Å‡§™‡•ç‡§∞‡§≠‡§æ‡§§"],"good night":["‡§∂‡•Å‡§≠ ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø"]
  },
  te:{
    "hello":["‡∞®‡∞Æ‡∞∏‡±ç‡∞§‡±á","‡∞π‡∞≤‡±ã","‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç"],"hi":["‡∞®‡∞Æ‡∞∏‡±ç‡∞§‡±á","‡∞π‡∞æ‡∞Ø‡±ç"],
    "thanks":["‡∞ß‡∞®‡±ç‡∞Ø‡∞µ‡∞æ‡∞¶‡∞æ‡∞≤‡±Å"],"thank you":["‡∞ß‡∞®‡±ç‡∞Ø‡∞µ‡∞æ‡∞¶‡∞æ‡∞≤‡±Å"],
    "sorry":["‡∞ï‡±ç‡∞∑‡∞Æ‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø"],"please":["‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø"],
    "good morning":["‡∞∂‡±Å‡∞≠‡±ã‡∞¶‡∞Ø‡∞Ç"],"good night":["‡∞∂‡±Å‡∞≠ ‡∞∞‡∞æ‡∞§‡±ç‡∞∞‡∞ø"]
  },
  ta:{
    "hello":["‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç","‡Æπ‡Æ≤‡Øã"],"hi":["‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç","‡Æπ‡Ææ‡ÆØ‡Øç"],
    "thanks":["‡Æ®‡Æ©‡Øç‡Æ±‡Æø"],"thank you":["‡Æ®‡Æ©‡Øç‡Æ±‡Æø"],
    "sorry":["‡ÆÆ‡Æ©‡Øç‡Æ©‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç"],"please":["‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ"],
    "good morning":["‡Æï‡Ææ‡Æ≤‡Øà ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç"],"good night":["‡Æá‡Æ©‡Æø‡ÆØ ‡Æá‡Æ∞‡Æµ‡ØÅ"]
  },
  kn:{
    "hello":["‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞","‡≤π‡≤≤‡≥ã"],"hi":["‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞","‡≤π‡≤æ‡≤Ø‡≥ç"],
    "thanks":["‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å"],"thank you":["‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å"],
    "sorry":["‡≤ï‡≥ç‡≤∑‡≤Æ‡≤ø‡≤∏‡≤ø"],"please":["‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å"],
    "good morning":["‡≤∂‡≥Å‡≤≠‡≥ã‡≤¶‡≤Ø"],"good night":["‡≤∂‡≥Å‡≤≠ ‡≤∞‡≤æ‡≤§‡≥ç‡≤∞‡≤ø"]
  },
  bn:{
    "hello":["‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã","‡¶®‡¶Æ‡¶∏‡ßç‡¶ï‡¶æ‡¶∞"],"hi":["‡¶π‡¶æ‡¶á","‡¶®‡¶Æ‡¶∏‡ßç‡¶ï‡¶æ‡¶∞"],
    "thanks":["‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶"],"thank you":["‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶"],
    "sorry":["‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§"],"please":["‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá"],
    "good morning":["‡¶∏‡ßÅ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶§"],"good night":["‡¶∂‡ßÅ‡¶≠ ‡¶∞‡¶æ‡¶§‡ßç‡¶∞‡¶ø"]
  }
  /* Add the other language mappings exactly from your earlier code */
};

function looksEnglish(s){ return /^[\x00-\x7F]+$/.test(s); }

function normalizeKey(s){
  // Lowercase, trim, and strip basic punctuation so "hi!" still matches "hi"
  return s.toLowerCase().trim().replace(/[.,!?;:()"'`]/g,"");
}

function applyOverrides(q, target, style) {
  const key=normalizeKey(q), dict=OVERRIDES[target];
  if (!dict) return null;
  const options=dict[key];
  if (!options) return null;
  const primary = style==="translit" && options[1] ? options[1] : options[0];
  return {primary, options};
}

function showAlternatives(options){
  const altsBox=document.getElementById("alts");
  altsBox.innerHTML="";
  if (!options) return;
  const label=document.createElement("div");
  label.textContent="Alternatives:";
  altsBox.appendChild(label);
  options.forEach(opt=>{
    const span=document.createElement("span");
    span.className="chip";
    span.textContent=opt;
    span.onclick=()=>document.getElementById("outputText").value=opt;
    altsBox.appendChild(span);
  });
}

/* ====== TRANSLATION SERVICES ====== */
const LT_ENDPOINTS=[
  "https://libretranslate.de/translate",
  "https://translate.argosopentech.com/translate",
  "https://libretranslate.com/translate"
];

function withTimeout(promise, ms=8000){
  return Promise.race([
    promise,
    new Promise((_,rej)=>setTimeout(()=>rej(new Error("timeout")), ms))
  ]);
}

async function tryLibreTranslate(q,target,forceEn=false){
  const payload={q,source:forceEn?"en":"auto",target,format:"text"};
  for (const url of LT_ENDPOINTS){
    try{
      const res=await withTimeout(fetch(url,{
        method:"POST",
        headers:{"Content-Type":"application/json","Accept":"application/json"},
        body:JSON.stringify(payload)
      }));
      if (!res.ok) continue;
      const data=await res.json();
      if (data?.translatedText) return data.translatedText.trim();
    }catch(_){} // continue to next endpoint
  }
  return null;
}

async function detectLang(q){
  try{
    const res=await withTimeout(fetch("https://libretranslate.de/detect",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({q})
    }));
    const data=await res.json();
    if (Array.isArray(data) && data[0]?.language) return data[0].language;
  }catch(_){}
  return looksEnglish(q)?"en":"auto";
}

async function tryMyMemory(q,target){
  try{
    let src=await detectLang(q);
    if (src==="auto") src=looksEnglish(q)?"en":"en";
    const url=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(q)}&langpair=${src}|${target}`;
    const res=await withTimeout(fetch(url));
    if (!res.ok) return null;
    const data=await res.json();
    if (data?.responseData?.translatedText) {
      return (data.responseData.translatedText||"").replace(/&#39;/g,"'").trim();
    }
  }catch(_){}
  return null;
}

/* ====== MAIN TRANSLATE ACTION ====== */
const translateBtn=document.getElementById("translateButton");
const voiceBtn=document.getElementById("voiceButton");
const statusEl=document.getElementById("status");
const outBox=document.getElementById("outputText");
const inputBox=document.getElementById("inputText");

function setBusy(b){
  translateBtn.disabled=b; voiceBtn.disabled=b;
}

translateBtn.addEventListener("click",async()=>{
  try{
    const text=inputBox.value.trim();
    const target=document.getElementById("toLang").value;
    const style=document.getElementById("style").value;
    document.getElementById("alts").innerHTML="";
    if (!text){ alert("Enter text to translate!"); return; }
    statusEl.textContent="Translating...";
    outBox.value="";
    setBusy(true);

    const override=applyOverrides(text,target,style);
    if (override){
      outBox.value=override.primary;
      showAlternatives(override.options);
      statusEl.textContent="Used curated translation ‚úÖ";
      setBusy(false);
      return;
    }

    const forceEn=looksEnglish(text);
    let translated=await tryLibreTranslate(text,target,forceEn);
    if (!translated) translated=await tryMyMemory(text,target);

    if (translated){
      outBox.value=translated;
      statusEl.textContent="Done.";
    } else {
      statusEl.textContent="Translation failed. Try again later.";
    }
  } catch (e){
    console.error(e);
    statusEl.textContent="Unexpected error. Check network/console.";
  } finally {
    setBusy(false);
  }
});

/* ====== IMPROVED VOICE FEATURE ====== */
let recognition, recognizing=false;
function setStatus(msg){statusEl.textContent=msg;}
voiceBtn.addEventListener('click',()=>{
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if (!SR){setStatus("‚ùå Speech recognition not supported.");return;}
  const isSecure=location.protocol==="https:"||location.hostname==="localhost";
  if (!isSecure){setStatus("‚ö† Use HTTPS or localhost for mic.");return;}
  if (!recognition){
    recognition=new SR();
    recognition.continuous=false;
    recognition.interimResults=false;
    recognition.maxAlternatives=1;
  }
  if (!recognizing){
    recognition.lang=document.getElementById('fromLang').value+'-IN';
    recognition.start();
    recognizing=true;
    setStatus("üé§ Listening...");
  } else {
    recognition.stop();
    recognizing=false;
    setStatus("‚èπ Stopped listening");
  }
  recognition.onresult=function(e){
    if (e.results[0]&&e.results[0][0]){
      inputBox.value=e.results[0][0].transcript;
      setStatus("‚úÖ Heard: "+e.results[0][0].transcript);
    }
    recognizing=false;
  };
  recognition.onerror=function(e){
    setStatus("‚ùå Mic error: "+(e.error||"unknown"));
    recognizing=false;
  };
  recognition.onend=function(){
    recognizing=false;
    if (statusEl.textContent.includes("Listening")) setStatus("‚ö† No speech detected.");
  };
});
</script>
</body>
</html>
